#!/usr/bin/env bash
# Commit message validation hook for nix-mox repository
# Enforces conventional commit message format

set -e

COMMIT_MSG_FILE=$1

echo "ğŸ“ Validating commit message..."

# Check if we're in a nix development environment, if not enter it
if [[ -z "$IN_NIX_SHELL" ]]; then
    exec nix --extra-experimental-features "nix-command flakes" develop --command bash "$0" "$@"
fi

# Validate commit message format
if ! nu scripts/maintenance/ci/commit-msg-check.nu validate --file="$COMMIT_MSG_FILE"; then
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âŒ Commit message validation failed!"
    echo ""
    echo "Please follow conventional commit format:"
    echo "  <type>(<scope>): <subject>"
    echo ""
    echo "Examples:"
    echo "  feat: add user authentication"
    echo "  fix(auth): resolve login timeout"
    echo "  docs: update README"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    exit 1
fi

echo "âœ… Commit message format is valid!"